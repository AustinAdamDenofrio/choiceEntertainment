<!doctype html>
<html lang="en">

<head>
    <title>APP Name: A coding challenge</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Dev Icons -->
    <link rel="stylesheet" type='text/css' href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css" />

    <!-- Prism CSS -->
    <link rel="stylesheet" href="/css/prism.css">

    <!-- Custom Themes -->
    <link rel="stylesheet" href="/css/themes.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/site.css">
</head>

<body class="" data-ad-theme="orange">
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-xxl">
                <a class="navbar-brand" href="/index.html"> <img src="/img/ChoiceMovieImgs/ChoiceMovie_Logo_sm.png"
                        alt="Logo" height="30" class="me-3" />Choice Movies</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                    aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="/index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/app.html">The App</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/code.html">The Code</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://github.com/AustinAdamDenofrio/choiceEntertainment"
                                target="_blank">The Repo</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>


    <main class="container-xxl py-3 mt-3">
        <h1 class="border-bottom border-dark">The Code</h1>
        <div class="row">

            <!-- The Code Example -->
            <div class="col-12 col-lg-8">
                <pre class="line-numbers">
                    <code class="language-js">
                        // #region                                                     ****************  Get a list of movies to populate page  *******************
//Return a list of an array of movies objects or empty array.
async function getPopularMovies() {

    try{
        // Step 1: get URL
        const getPopularMoviesUrl = 'https://api.themoviedb.org/3/movie/popular';

        // Step2: call the API

        //Store whatever the response is, but need a var.
        // var response holds the json response from the fetch.
        let response = await fetch(getPopularMoviesUrl, {
            headers: {
                'Authorization': `Bearer ${API_KEY}`
            }
        });

        if(response.ok){
            let data = await response.json();
            return data.results;
        }else{
            return [];
        }

    } catch(error){
        console.log(error)
        return [];
    }
    
}

async function displayPopularMovies(){
    let movies = await getPopularMovies();
    displayMovies(movies);
}

function displayFavoriteMovies(){
    let favorite = getFavoriteMovies();
    displayMovies(favorite);
}

function displayMovies(movies){
    // Get movie Card Template from HTML
    const movieCardTemplate = document.getElementById('movie-card-template');

    //find the element where the movie card WILL go 
    const movieRow = document.getElementById('movie-row');

    // resets the html section of the movies
    movieRow.innerHTML = '';

    // we need a card for each movie in the movie array
    for (const movie of movies){

        // Copy of the template between the opening and closing tag
        let movieCard = movieCardTemplate.content.cloneNode(true);

        // modify the template with the current movie
        let titleElement = movieCard.querySelector('.card-body > h5');
        titleElement.textContent = movie.title;

        let descriptionElement = movieCard.querySelector('.card-text');
        descriptionElement.textContent = movie.overview;

        let movieImgElement = movieCard.querySelector('.card-img-top');
        movieImgElement.setAttribute('src', `https://image.tmdb.org/t/p/w500${movie.poster_path}`);

        let infoButton = movieCard.querySelector('.btn-primary');
        infoButton.setAttribute('data-movieId', movie.id);

        let favoriteButton = movieCard.querySelector('.btn-outline-primary');
        favoriteButton.setAttribute('data-movieId', movie.id);

        // add it to the page
        movieRow.appendChild(movieCard);
        
    }
}

function removeFavorite(button){
    // get our array of favorite movies
    let favorites = getFavoriteMovies();
    // search for a movie with data-movieId that is on this button
    // remove movie from array
    const movieId = button.getAttribute('data-movieId');
    // filter says return whatever is according to the (parameter)
    let newFavorites = favorites.filter(movie => movie.id != movieId);
    // save back to array
    saveFavoriteMovies(newFavorites);
    // Update on the page
    displayFavoriteMovies();


    // refresh page

}
// #endregion                                                     ****************  Get a list of movies to populate page  *******************



//  #region                                         **************** Make dynamic MODAL that will display individual movie details  *******************
// Movie Details
// Step1: When the user clicks the more info button show the modal
// Step2: Call API. Make sure the data is coming back aka in the network tab
// Step 3 modify the modal.
async function getMovieDetail(movieId){
    
    // API URL for specific movie ID
    const movieDetailUrl = `https://api.themoviedb.org/3/movie/${movieId}`;

    try{
        // call the API
        //Store whatever the response is, but need a var.
        // var response holds the json response from the fetch.
        let response = await fetch(movieDetailUrl, {
            headers: {
                'Authorization': `Bearer ${API_KEY}`
            }
        });

        if(response.ok){
            let movie = await response.json();
            results = movie;
            return results;
        }else{
            return undefined;
        }

    } catch(error){
        console.log(error)
        return undefined;
    }

    // const movieObject = moviesObjectArray.
}

async function showMovieDetails(button){

    let movieId = button.getAttribute('data-movieId');
    let movie = await getMovieDetail(movieId);

    if (movie != undefined){
        document.getElementById('modal-title').textContent = movie.title;
        document.getElementById('modal-title-name').textContent = movie.title;
        document.getElementById('modal-tagline').textContent = movie.tagline;
        document.getElementById('modal-synopsis').textContent = movie.overview;
        document.getElementById('movie-img').src = `https://image.tmdb.org/t/p/w500${movie.poster_path}`;


        let movieGenres = document.getElementById('movieGenre');
        movieGenres.innerHTML = '';

        // get the Genre
        movie.genres.forEach(genre => 
            {
                // store in memory
                let badge = document.createElement('span');
                badge.classList.add('badge', 'text-bg-primary');
                badge.textContent = genre.name;
                // alter in html
                movieGenres.appendChild(badge);
            }
        );        
        
    }

    // pop modal
    const modal = bootstrap.Modal.getOrCreateInstance('#movieModal');
    modal.show();

}





//  #endregion                                   **************** Make dynamic MODAL that will display individual movie details  *******************


// Add to favorites
async function addFavoriteMovie(button){
    // get the movie to add to favorites.
    // get the movie ID
    const movieId = button.getAttribute('data-movieId');
    let movies = getFavoriteMovies();

    let duplicateMovie = movies.find(movie => movie.id == movieId);

    // call getMovieDetails
    
    if (duplicateMovie == undefined){
        // get from TMDB
        const favoriteMovie = await getMovieDetail(movieId);
        // convert the movie to a string/json
        if(favoriteMovie != undefined){
            movies.push(favoriteMovie);
            saveFavoriteMovies(movies);
        }

    }


    // let the user know we did it

    // NOTE: What if they press the button more than once
}

function getFavoriteMovies(){
    let movieJSON = localStorage.getItem('ad-favorite-movies');
    let favoriteMovies = [];

    if (movieJSON == null){
        localStorage.setItem('ad-favorite-movies', '[]');
    }else{
        favoriteMovies = JSON.parse(movieJSON);
    }

    return favoriteMovies;
}

function saveFavoriteMovies(favoriteMovies){
    let moviesAsString = JSON.stringify(favoriteMovies);
    localStorage.setItem('ad-favorite-movies', moviesAsString);
}
                    </code>
                </pre>
            </div>
        </div>
    </main>


    <footer class="container-fluid py-3">
        <div class="container-xxl">
            <div class="row align-items-center row-cols-1 row-cols-lg-3 gy-2">
                <div class="col order-last order-lg-first text-center text-lg-start">
                    &copy; 2024 Austin Denofrio
                </div>
                <div class="col text-center">
                    <a href="https://denofrio-fullstack-developer.netlify.app/" target="_blank"><img
                            src="/img/signature_dark.svg" height="30" alt="Logo" /></a>
                </div>
                <div class="col text-center text-lg-end">
                    <a class="text-decoration-none" target="_blank"
                        href="https://www.linkedin.com/in/austin-denofrio-286792223/"><i class="bi bi-linkedin"></i></a>
                    <a class="text-decoration-none" target="_blank" href="https://github.com/AustinAdamDenofrio"><i
                            class="bi bi-github"></i></a>
                    <a class="text-decoration-none" target="_blank" href="https://twitter.com/A_Denofrio"><i
                            class="bi bi-twitter-x"></i></a>
                    <a class="text-decoration-none" target="_blank" href="mailto:denofrioaustindev@gmail.com"><i
                            class="bi bi-envelope-at-fill"></i></a>

                </div>

            </div>
        </div>
    </footer>


    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Prism JS -->
    <script src="/js/prism.js"></script>
    <script>
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
        })
    </script>
</body>

</html>